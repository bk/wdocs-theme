<%!
description = ''
title = 'Frontpage'
extra_css = []
header_class = ''
nav_class = ''
main_class = 'items-fixed'
%>\
<!DOCTYPE html>
<html lang="${ site.lang or 'en' }">
    <head>
      <%block name="site_meta">
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        % if page.description or self.attr.description:
          <meta name="description" content="${ page.description or self.attr.description }">
        % endif
        % if site.author:
          <meta name="author" content="${ site.author }">
        % endif
        % if page.canonical_url:
          <link rel="canonical" href="${ page.canonical_url }">
        % endif
        % if site.favicon:
          <link rel="shortcut icon" href="${ site.favicon | url }">
        % else:
          <link rel="shortcut icon" href="${ 'img/favicon.ico' | url }">
        % endif
      </%block>

      <%block name="htmltitle">
        <title>${ page.title or _(self.attr.title) } - ${ site.name }</title>
      </%block>

      <%block name="styles">
        <link href="${ 'css/avec/avec.min.css' | url }" rel="stylesheet">
        <link href="${ 'css/font-awesome.min.css' | url }" rel="stylesheet">
        <link href="${ 'css/wdocs.css' | url }" rel="stylesheet">
        % if site.highlightjs:
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/${ site.hljs_style or 'github' }.min.css">
        % endif
        % for path in self.attr.extra_css:
        <link href="${ path | url }" rel="stylesheet">
        % endfor
        % for path in (site.extra_css or []):
        <link href="${ path | url }" rel="stylesheet">
        % endfor
        % for path in (page.extra_css or []):
        <link href="${ path | url }" rel="stylesheet">
        % endfor
      </%block>

      <%block name="libs">
        % if site.highlightjs:
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
        % for lang in site.hljs_languages:
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/${ lang }.min.js"></script>
        % endfor
        <script>hljs.initHighlightingOnLoad();</script>
        % endif
      </%block>

      <%block name="analytics">
        ### TBD
      </%block>

      <%block name="extrahead"></%block>
    </head>

    <body${ ' class="homepage"' if page and page.is_homepage else '' |n }>
    <%block name="header">
      <header class="reverse-theme ${ self.attr.header_class }">
        <div class="container items-fixed">
        <nav class="${ self.attr.nav_class }">
          <a href="${ '/' | url }" class="text brand larger">
            <strong>${ site.name }</strong>
          </a>
          <%block name="nav_menu">
            <!-- Desktop menu -->
            % if len(nav) > 1:
              <ul class="seen-011 hidden-sm mr-a">
                % for nav_item in nav:
                  % if nav_item.is_link and nav_item.is_homepage and nav.homepage:
                    ## No need to repeat the Home link since we
                    ## have it already in navbar-brand above.
                    <% continue %>
                  % elif nav_item.children:
                    <li><details role="dropdown" class="${ 'active' if nav_item.contains_url(SELF_URL, url, best=False) else '' }">
                      <summary>${ nav_item.title }</summary>
                      <ul>
                        % for it in nav_item:
                          ## Note: possibly nested
                          ${ _nav_sub(it, SELF_URL) }
                        % endfor
                      </ul>
                    </details></li>
                  % else:
                    <li><a href="${ nav_item.url | url }" class="${ ' active' if nav_item.contains_url(SELF_URL, url, best=True) else '' }">${ nav_item.title }</a></li>
                  % endif
                % endfor
              </ul>
            % endif
            <ul class="seen-011 hidden-sm">
              ${ _search_and_prevnext() }
            </ul>
            </ul>
            <!-- Mobile menu -->
            <div class="seen-110 hidden-md">
              <input id="main-menu" type="checkbox" class="show-menu">
              <label for="main-menu" class="burger pr-1">
                <span class="menu-icon"></span>
              </label>
              <div class="menu has-close">
                <label for="main-menu" class="close">&times;</label>
                <h4>${ _("Menu") }</h4>
                <ul>
                  % if len(nav) > 1:
                    % for nav_item in nav:
                      ${ _nav_sub(nav_item, SELF_URL) }
                    % endfor
                  % endif
                </ul>
                ${ _search_and_prevnext() }
              </div>
            </div>
          </%block>
        </nav>
        </div>
      </header>
    </%block>
    <main class="${ self.attr.main_class }">
      <%block name="content">
        % if page and (page.is_homepage or page.no_sidebar):
          <section role="main">
            ${ CONTENT }
          </section>
        % else:
          <section class="cols">
            <div class="cw3-md"><%include file="toc.mc" /></div>
            <div class="cw9-md" role="main">
              ${ CONTENT if CONTENT else '<!-- no content?? -->' }
            </div>
          </section>
        % endif
      </%block>
    </main>
    <%block name="footer">
    <footer class="reverse-theme">
      % if site.copyright:
        <p>${ site.copyright }</p>
      % endif
      % if site.tagline:
        <p>${ site.tagline }</p>
      % endif
    </footer>
    </%block>
    % if site.lunr_search:
      <%include file="search-modal.mc" />
    % endif
    ## <%include file="keyboard-modal.mc" />
    <%block name="scripts">
    <% shortcuts = site.shortcuts or {'help': 72, 'next': 78, 'previous': 80, 'search': 83} %>
    <script>
      var base_url = ${ site.leading_path or site.base_url or '/' | to_json },
          shortcuts = ${ to_json(shortcuts)  };
    </script>
    <script src="${ 'js/wdocs.js' | url }" defer></script>
    % for path in site.extra_javascript:
      <script src="${ path | url }" defer></script>
    % endfor
    </%block>
  </body>
</html>
\
<%def name="_search_and_prevnext()">
  % if site.lunr_search:
    <li><label for="wdocs_search_modal" rel="search" role="link" class="plain mb-0"><i class="fa fa-search"></i> ${ _("Search") }</label></li>
  % endif
  <%
    next_url = page.next_page if page and page.next_page else None
    prev_url = page.previous_page if page and page.previous_page else None
    if not next_url and not prev_url:
        links = nav._links_in_order()
        foundme = [_ for _ in links if _.is_url(SELF_URL, url)]
        if foundme:
            next_url = foundme[0].next.url if foundme[0].next else None
            prev_url = foundme[0].previous.url if foundme[0].previous else None
  %>
  % if next_url or prev_url:
    % if prev_url:
      <li><a rel="prev" href="${ prev_url | url }">
        <i class="fa fa-arrow-left"></i> ${ _("Previous") }
      </a></li>
    % else:
      <li><span rel="prev" class="disabled">
        <i class="fa fa-arrow-left"></i> ${ _("Previous") }
      </span></li>
    % endif
    % if next_url:
      <li><a rel="next" href="${ next_url | url }"">
        <i class="fa fa-arrow-right"></i> ${ _("Next") }
      </a></li>
    % else:
      <li><span rel="prev" class="disabled">
        <i class="fa fa-arrow-right"></i> ${ _("Next") }
      </span></li>
    % endif
  % endif
</%def>\
\
<%def name="_nav_sub(nav_item, current_url='')">
  % if not nav_item.children:
    <li>
      <a href="${ nav_item.url | url }" class="${ 'active' if nav_item.contains_url(current_url, url, best=True)  else '' }">${ nav_item.title }</a>
    </li>
  % else:
    <li>
      ${ nav_item.title }:
      <ul>
        % for it in nav_item:
          ${ _nav_sub(it) }
        % endfor
      </ul>
    </li>
  % endif
</%def>\
